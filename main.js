(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-2",headers:{authorization:"29e47ff3-c405-4d45-9bbb-503bd9191003","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},n=function(){return fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t)};function r(n){var r="".concat(e.baseUrl,"/cards/likes/").concat(n);return fetch(r,{method:"PUT",headers:e.headers}).then(t)}function o(n){var r="".concat(e.baseUrl,"/cards/likes/").concat(n);return fetch(r,{method:"DELETE",headers:e.headers}).then(t)}function c(e,t,n,r,o){var c=document.getElementById("card-template").content.firstElementChild.cloneNode(!0),a=c.querySelector(".card__title"),i=c.querySelector(".card__image"),u=c.querySelector(".card__like-count"),l=c.querySelector(".card__like-button"),s=c.querySelector(".card__delete-button");a.textContent=e.name,i.src=e.link,i.alt=e.name,u.textContent=e.likes.length,l.addEventListener("click",(function(){n(l,u,e._id,o)}));var d=e._id,p=function(e,t){var n=localStorage.getItem("like_".concat(e));if(n){var r=JSON.parse(n),o=r.some((function(e){return e._id===t}));return{likes:r,isLikedByOwner:o}}return{likes:[],isLikedByOwner:!1}}(d,o),f=p.likes,_=p.isLikedByOwner;return l.classList.toggle("card__like-button_is-active",_),u.textContent=f.length,o===e.owner._id?s.addEventListener("click",(function(){t(c,d)})):s.style.display="none",i.addEventListener("click",(function(){r(c,i)})),c}function a(e,t,n,c){(e.classList.contains("card__like-button_is-active")?o:r)(n).then((function(r){localStorage.setItem("like_".concat(n),JSON.stringify(r.likes)),e.classList.toggle("card__like-button_is-active",r.likes.some((function(e){return e._id===c}))),t.textContent=r.likes.length})).catch((function(e){console.error("Ошибка лайка:",e)}))}function i(e,n){(function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-2/cards/".concat(e),{method:"DELETE",headers:{authorization:"29e47ff3-c405-4d45-9bbb-503bd9191003"}}).then(t)})(n).then((function(){e.remove()})).catch((function(e){console.error("Ошибка удаления карточки:",e)}))}function u(e){e.classList.add("popup_is-animated"),e.classList.add("popup_is-opened"),document.addEventListener("keydown",s),document.addEventListener("click",d)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s),document.removeEventListener("click",d)}var s=function(e){"Escape"===e.code&&l(document.querySelector(".popup_is-opened"))},d=function(e){var t=e.target;t.classList.contains("popup_is-opened")&&l(t)};function p(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){f(e,n,t)})),r&&m(r,t)}function f(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent="",r.classList.remove(n.errorClass),t.classList.remove(n.inputErrorClass)}function _(e,t,n){e.every((function(e){return e.validity.valid}))?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):m(t,n)}function m(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),S=document.querySelector(".popup_type_avatar"),C=v.querySelector(".popup__form"),q=h.querySelector(".popup__form"),L=S.querySelector(".popup__form"),E=document.querySelector(".profile__edit-button"),k=document.querySelectorAll(".popup__close"),g=document.querySelector(".profile__add-button"),x=document.querySelector(".popup__image"),w=document.querySelector(".popup__caption"),A=document.querySelector(".profile__image");A.addEventListener("click",(function(){u(S)}));var O=document.querySelector(".places__list"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function B(e,t){u(b);var n=e.querySelector(".card__title");x.src=t.src,w.textContent=n.textContent,b.src=t.src,b.alt=n.textContent}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);p(e,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){if(t.validity.patternMismatch){var r=t.dataset.errorMessage||t.validationMessage;""===t.value.trim()?t.setCustomValidity(""):t.setCustomValidity(r)}else t.setCustomValidity("");t.validity.valid?f(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));o.textContent=n,o.classList.add(r.errorClass),t.classList.add(r.inputErrorClass)}(e,t,t.validationMessage,n)}(e,o,t),_(n,r,t)}))})),e.addEventListener("reset",(function(){p(e,t)})),_(n,r,t)}(t,e)}))}(I),k.forEach((function(e){e.addEventListener("click",(function(){l(e.closest(".popup"))}))})),E.addEventListener("click",(function(){u(v),p(C,I),U.value=T.textContent,j.value=D.textContent;var e=C.querySelector(".popup__button");e.removeAttribute("disabled"),e.classList.remove("popup__button_disabled")}));var U=C.querySelector(".popup__input_type_name"),j=C.querySelector(".popup__input_type_description"),T=document.querySelector(".profile__title"),D=document.querySelector(".profile__description");U.value=T.textContent,j.value=D.textContent,Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t),n()]).then((function(e){var t,r,o,u,l,s,d,p=(d=2,function(e){if(Array.isArray(e))return e}(s=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(s,d)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(s,d)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=p[0],_=p[1];return window.userInfo=f,T.textContent=f.name,D.textContent=f.about,A.style.backgroundImage="url(".concat(f.avatar,")"),O.innerHTML="",t=_,r=i,o=a,u=B,l=window.userInfo._id,t.forEach((function(e){var t=c(e,r,o,u,l);O.appendChild(t)})),n()})).catch((function(e){console.error("Произошла ошибка:",e)})),C.addEventListener("submit",(function(n){n.preventDefault();var r,o,c=C.querySelector(".popup__button");c.textContent="Сохранение...",(r=U.value,o=j.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r,about:o})}).then(t)).then((function(e){T.textContent=e.name,D.textContent=e.about})).finally((function(){c.textContent="Сохранить"})),l(v),p(C,I)})),g.addEventListener("click",(function(){u(h),q.reset(),p(q,I)})),q.addEventListener("submit",(function(n){n.preventDefault();var r,o,u=n.target,s=new FormData(u),d=Object.fromEntries(s),p=d["place-name"],f=d.link,_=q.querySelector(".popup__button");_.textContent="Сохранение...",(r=p,o=f,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:o})}).then(t)).then((function(e){var t=c(e,i,a,B,userInfo._id);O.prepend(t),u.reset(),l(h)})).catch((function(e){console.error("Ошибка добавления карточки:",e)})).finally((function(){_.textContent="Сохранить"})),l(h)})),document.querySelectorAll(".popup").forEach((function(e){return e.classList.add("popup_is-animated")})),L.addEventListener("submit",(function(n){n.preventDefault();var r=n.target.querySelector(".popup__input_type_avatar-url").value,o=L.querySelector(".popup__button");o.textContent="Сохранение...",function(n){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then(t)}(r).then((function(){A.style.backgroundImage="url(".concat(r,")"),l(S),L.reset()})).catch((function(e){console.error("Ошибка обновления аватара:",e)})).finally((function(){o.textContent="Сохранить"}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0JuRixTQUFTZ0UsaUJBQWlCLFVBQ2xDSSxTQUFRLFNBQUM0RSxHQUFHLE9BQUtBLEVBQUlsSCxVQUFVb0IsSUFBSSxvQkFBb0IsSUFHL0RzQyxFQUFldEUsaUJBQWlCLFVBQVUsU0FBVXFDLEdBQ2xEQSxFQUFNOEMsaUJBRU4sSUFDTTRDLEVBRGtCMUYsRUFBTUcsT0FBT3BELGNBQWMsaUNBQ2hCb0csTUFDN0JhLEVBQWEvQixFQUFlbEYsY0FBYyxrQkFDaERpSCxFQUFXNUcsWUFBYyxnQkp6SUMsU0FBQ3NJLEdBQzNCLE9BQU8vSixNQUFNLEdBQURILE9BQUlWLEVBQU9DLFFBQU8sb0JBQW9CLENBQ2hEaUIsT0FBUSxRQUVSaEIsUUFBU0YsRUFBT0UsUUFFaEI4SixLQUFNN0csS0FBS2dCLFVBQVUsQ0FBRXlGLE9BQVFnQixNQUM5QjlKLEtBQUtWLEVBQ1YsQ0ltSUV5SyxDQUFhRCxHQUNWOUosTUFBSyxXQUNKMkcsRUFBVzdELE1BQU0rRixnQkFBa0IsT0FBSGpKLE9BQVVrSyxFQUFVLEtBQ3BENUYsRUFBV2dDLEdBQ1hHLEVBQWUrQyxPQUNqQixJQUNDOUYsT0FBTSxTQUFBQyxHQUNMQyxRQUFRRCxNQUFNLDZCQUE4QkEsRUFDOUMsSUFDQzRGLFNBQVEsV0FDUGYsRUFBVzVHLFlBQWMsV0FDM0IsR0FDSixHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy9hcGkuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy9jYXJkLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2NvbXBvbmVudHMvbW9kYWwuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIGJhc2VVcmw6ICdodHRwczovL25vbW9yZXBhcnRpZXMuY28vdjEvd2ZmLWNvaG9ydC0yJyxcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246ICcyOWU0N2ZmMy1jNDA1LTRkNDUtOWJiYi01MDNiZDkxOTEwMDMnLFxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgfVxufVxuXG5jb25zdCBoYW5kbGVSZXNwb25zZSA9IChyZXMpID0+IHtcbiAgaWYgKHJlcy5vaykge1xuICAgIHJldHVybiByZXMuanNvbigpO1xuICB9XG4gIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0SW5pdGlhbENhcmRzID0gKCkgPT4ge1xuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzYCwge1xuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzXG4gIH0pLnRoZW4oaGFuZGxlUmVzcG9uc2UpO1xufVxuXG5leHBvcnQgY29uc3QgdXBkYXRlVXNlckluZm8gPSAobmFtZSwgYWJvdXQpID0+IHtcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICBtZXRob2Q6ICdQQVRDSCcsXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBhYm91dCB9KVxuICB9KS50aGVuKGhhbmRsZVJlc3BvbnNlKTtcbn1cblxuZXhwb3J0IGNvbnN0IGdldFVzZXJJbmZvID0gKCkgPT4ge1xuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzXG4gIH0pLnRoZW4oaGFuZGxlUmVzcG9uc2UpO1xufVxuXG5leHBvcnQgY29uc3QgcG9zdENhcmQgPSAobmFtZSwgbGluaykgPT4ge1xuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzYCwge1xuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIG5hbWUsXG4gICAgICBsaW5rXG4gICAgfSlcbiAgfSkudGhlbihoYW5kbGVSZXNwb25zZSk7XG59XG5cbmV4cG9ydCBjb25zdCBkZWxldGVDYXJkRnJvbVNlcnZlciA9IChjYXJkSWQpID0+IHtcbiAgcmV0dXJuIGZldGNoKGBodHRwczovL25vbW9yZXBhcnRpZXMuY28vdjEvd2ZmLWNvaG9ydC0yL2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIGF1dGhvcml6YXRpb246ICcyOWU0N2ZmMy1jNDA1LTRkNDUtOWJiYi01MDNiZDkxOTEwMDMnXG4gICAgfVxuICB9KS50aGVuKGhhbmRsZVJlc3BvbnNlKTtcbn07XG5cblxuZXhwb3J0IGZ1bmN0aW9uIHBvc3RMaWtlKGNhcmRJZCkge1xuICBjb25zdCBhcGlVcmwgPSBgJHtjb25maWcuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YDtcbiAgcmV0dXJuIGZldGNoKGFwaVVybCwge1xuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcbiAgfSkudGhlbihoYW5kbGVSZXNwb25zZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVMaWtlKGNhcmRJZCkge1xuICBjb25zdCBhcGlVcmwgPSBgJHtjb25maWcuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YDtcbiAgcmV0dXJuIGZldGNoKGFwaVVybCwge1xuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcbiAgfSkudGhlbihoYW5kbGVSZXNwb25zZSk7XG59XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVBdmF0YXIgPSAoYXZhdGFyTGluaykgPT4ge1xuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICBtZXRob2Q6ICdQQVRDSCcsXG5cbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcblxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXZhdGFyOiBhdmF0YXJMaW5rIH0pXG4gIH0pLnRoZW4oaGFuZGxlUmVzcG9uc2UpO1xufSIsIlxuaW1wb3J0IHsgZGVsZXRlQ2FyZEZyb21TZXJ2ZXIsIHBvc3RMaWtlLCBkZWxldGVMaWtlIH0gZnJvbSBcIi4vYXBpXCI7XG5cbi8vINCk0YPQvdC60YbQuNGPINGB0L7Qt9C00LDQvdC40Y8g0LrQsNGA0YLQvtGH0LrQuFxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNhcmQoZGF0YSwgZGVsZXRlQ2FsbGJhY2ssIHRvb2dsZUhlYXJ0Q2FsbGJhY2ssIG9wZW5CaWdJbWFnZUNhbGxiYWNrLCBvd25lcklkKSB7XG4gIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkLXRlbXBsYXRlJyk7XG4gIGNvbnN0IG5ld0NhcmQgPSBjYXJkVGVtcGxhdGUuY29udGVudC5maXJzdEVsZW1lbnRDaGlsZC5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgY29uc3QgdGl0bGVDYXJkZWwgPSBuZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX190aXRsZScpO1xuICBjb25zdCBwaG90b0NhcmRFbCA9IG5ld0NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgbGlrZUNvdW50RWxlbWVudCA9IG5ld0NhcmQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtY291bnQnKTtcbiAgY29uc3QgbGlrZUhlYXJ0ID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICBjb25zdCBkZWxldGVJY29uID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpO1xuXG4gIHRpdGxlQ2FyZGVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICBwaG90b0NhcmRFbC5zcmMgPSBkYXRhLmxpbms7XG4gIHBob3RvQ2FyZEVsLmFsdCA9IGRhdGEubmFtZTtcbiAgbGlrZUNvdW50RWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEubGlrZXMubGVuZ3RoO1xuXG4gIGxpa2VIZWFydC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICB0b29nbGVIZWFydENhbGxiYWNrKGxpa2VIZWFydCwgbGlrZUNvdW50RWxlbWVudCwgZGF0YS5faWQsIG93bmVySWQpO1xuICB9KTtcblxuICBjb25zdCBjYXJkSWQgPSBkYXRhLl9pZDtcblxuICBjb25zdCB7IGxpa2VzLCBpc0xpa2VkQnlPd25lciB9ID0gbG9hZExpa2VzU3RhdGUoY2FyZElkLCBvd25lcklkKTtcbiAgbGlrZUhlYXJ0LmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmVcIiwgaXNMaWtlZEJ5T3duZXIpO1xuICBsaWtlQ291bnRFbGVtZW50LnRleHRDb250ZW50ID0gbGlrZXMubGVuZ3RoO1xuXG4gIGlmIChvd25lcklkID09PSBkYXRhLm93bmVyLl9pZCkge1xuICAgIGRlbGV0ZUljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBkZWxldGVDYWxsYmFjayhuZXdDYXJkLCBjYXJkSWQpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGRlbGV0ZUljb24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgfVxuXG4gIHBob3RvQ2FyZEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIG9wZW5CaWdJbWFnZUNhbGxiYWNrKG5ld0NhcmQsIHBob3RvQ2FyZEVsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIG5ld0NhcmQ7XG59XG5cbi8vINCk0YPQvdC60YbQuNGPINC+0LHRgNCw0LHQvtGC0LrQsCDQu9Cw0LnQutCwXG5leHBvcnQgZnVuY3Rpb24gdG9vZ2xlSGVhcnQoaGVhcnQsIGxpa2VDb3VudEVsZW1lbnQsIGNhcmRJZCwgb3duZXJJZCkge1xuICBjb25zdCBpc0xpa2VkID0gaGVhcnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlXCIpO1xuICBjb25zdCBsaWtlTWV0aG9kID0gaXNMaWtlZCA/IGRlbGV0ZUxpa2UgOiBwb3N0TGlrZTtcblxuICBsaWtlTWV0aG9kKGNhcmRJZClcbiAgICAudGhlbih1cGRhdGVkQ2FyZCA9PiB7XG4gICAgICAvLyDQodC+0YXRgNCw0L3Rj9C10Lwg0LjQvdGE0L7RgNC80LDRhtC40Y4g0L4g0LvQsNC50LrQtSDQsiDQu9C+0LrQsNC70YzQvdC+0LUg0YXRgNCw0L3QuNC70LjRidC1XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgbGlrZV8ke2NhcmRJZH1gLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVkQ2FyZC5saWtlcykpO1xuXG4gICAgICAvLyDQntGC0L7QsdGA0LDQttCw0LXQvCDRgdC+0YHRgtC+0Y/QvdC40LUg0LvQsNC50LrQsFxuICAgICAgaGVhcnQuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZVwiLCB1cGRhdGVkQ2FyZC5saWtlcy5zb21lKGxpa2UgPT4gbGlrZS5faWQgPT09IG93bmVySWQpKTtcbiAgICAgIGxpa2VDb3VudEVsZW1lbnQudGV4dENvbnRlbnQgPSB1cGRhdGVkQ2FyZC5saWtlcy5sZW5ndGg7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcign0J7RiNC40LHQutCwINC70LDQudC60LA6JywgZXJyb3IpO1xuICAgIH0pO1xufVxuXG4vLyDQpNGD0L3QutGG0LjRjyDQt9Cw0LPRgNGD0LfQutC4INGB0L7RgdGC0L7Rj9C90LjRjyDQu9Cw0LnQutC+0LIg0L/RgNC4INC30LDQs9GA0YPQt9C60LUg0YHRgtGA0LDQvdC40YbRi1xuZXhwb3J0IGZ1bmN0aW9uIGxvYWRMaWtlc1N0YXRlKGNhcmRJZCwgb3duZXJJZCkge1xuICBjb25zdCBzdG9yZWRMaWtlcyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGBsaWtlXyR7Y2FyZElkfWApO1xuXG4gIGlmIChzdG9yZWRMaWtlcykge1xuICAgIGNvbnN0IGxpa2VzID0gSlNPTi5wYXJzZShzdG9yZWRMaWtlcyk7XG4gICAgY29uc3QgaXNMaWtlZEJ5T3duZXIgPSBsaWtlcy5zb21lKGxpa2UgPT4gbGlrZS5faWQgPT09IG93bmVySWQpO1xuXG4gICAgcmV0dXJuIHsgbGlrZXMsIGlzTGlrZWRCeU93bmVyIH07XG4gIH1cblxuICByZXR1cm4geyBsaWtlczogW10sIGlzTGlrZWRCeU93bmVyOiBmYWxzZSB9O1xufVxuXG4vLyDQpNGD0L3QutGG0LjRjyDRg9C00LDQu9C10L3QuNGPINC60LDRgNGC0L7Rh9C60LhcbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVDYXJkKGNhcmRFbGVtZW50LCBjYXJkSWQpIHtcbiAgZGVsZXRlQ2FyZEZyb21TZXJ2ZXIoY2FyZElkKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGNhcmRFbGVtZW50LnJlbW92ZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ9Ce0YjQuNCx0LrQsCDRg9C00LDQu9C10L3QuNGPINC60LDRgNGC0L7Rh9C60Lg6JywgZXJyb3IpO1xuICAgIH0pO1xufSIsIi8v0KTRg9C90LrRhtC40Y8g0L7RgtC60YDRi9GC0LjRjyDQv9C+0L/QsNC/0LBcbmV4cG9ydCBmdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZCgncG9wdXBfaXMtYW5pbWF0ZWQnKTtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZCgncG9wdXBfaXMtb3BlbmVkJyk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBrZXlEb3duSGFuZGxlcik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZG9jdW1lbnRDbGlja0hhbmRsZXIpO1xufVxuLy/QpNGD0L3QutGG0LjRjyDQt9Cw0LrRgNGL0YLQuNGPINC/0L7Qv9Cw0L/QsFxuZXhwb3J0IGZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfaXMtb3BlbmVkJyk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBrZXlEb3duSGFuZGxlcik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZG9jdW1lbnRDbGlja0hhbmRsZXIpO1xufVxuXG5jb25zdCBrZXlEb3duSGFuZGxlciA9IChldmVudCkgPT4ge1xuICBpZiAoZXZlbnQuY29kZSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNvbnN0IG9wZW5lZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX2lzLW9wZW5lZCcpO1xuICAgIGNsb3NlTW9kYWwob3BlbmVkUG9wdXApO1xuICB9XG59XG5cbmNvbnN0IGRvY3VtZW50Q2xpY2tIYW5kbGVyID0gKHsgdGFyZ2V0IH0pID0+IHtcbiAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHVwX2lzLW9wZW5lZCcpKSB7XG4gICAgY2xvc2VNb2RhbCh0YXJnZXQpO1xuICB9XG59ICIsIlxuZXhwb3J0IGZ1bmN0aW9uIGVuYWJsZVZhbGlkYXRpb24oY29uZmlnKSB7XG4gIGNvbnN0IGZvcm1zID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcblxuICBmb3Jtcy5mb3JFYWNoKChmb3JtKSA9PiB7XG4gICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcblxuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm0sIGNvbmZpZyk7XG4gIH0pO1xufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBjbGVhclZhbGlkYXRpb24oZm9ybSwgY29uZmlnKSB7XG4gIGNvbnN0IGlucHV0cyA9IEFycmF5LmZyb20oZm9ybS5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGZvcm0ucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtLCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG4gIGlmIChzdWJtaXRCdXR0b24pIHtcbiAgICBkaXNhYmxlU3VibWl0QnV0dG9uKHN1Ym1pdEJ1dHRvbiwgY29uZmlnKVxuICB9XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldEV2ZW50TGlzdGVuZXJzKGZvcm0sIGNvbmZpZykge1xuICBjb25zdCBpbnB1dHMgPSBBcnJheS5mcm9tKGZvcm0ucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3RvcikpO1xuICBjb25zdCBzdWJtaXRCdXR0b24gPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcbiAgY2xlYXJWYWxpZGF0aW9uKGZvcm0sIGNvbmZpZylcbiAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybSwgaW5wdXQsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVTdWJtaXRCdXR0b25TdGF0ZShpbnB1dHMsIHN1Ym1pdEJ1dHRvbiwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdyZXNldCcsIGZ1bmN0aW9uICgpIHtcbiAgICBjbGVhclZhbGlkYXRpb24oZm9ybSwgY29uZmlnKTtcbiAgfSk7XG5cbiAgdG9nZ2xlU3VibWl0QnV0dG9uU3RhdGUoaW5wdXRzLCBzdWJtaXRCdXR0b24sIGNvbmZpZyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjaGVja0lucHV0VmFsaWRpdHkoZm9ybSwgaW5wdXQsIGNvbmZpZykge1xuICBpZiAoaW5wdXQudmFsaWRpdHkucGF0dGVybk1pc21hdGNoKSB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gaW5wdXQuZGF0YXNldC5lcnJvck1lc3NhZ2UgfHwgaW5wdXQudmFsaWRhdGlvbk1lc3NhZ2U7XG5cbiAgICBpZiAoaW5wdXQudmFsdWUudHJpbSgpID09PSAnJykge1xuICAgICAgaW5wdXQuc2V0Q3VzdG9tVmFsaWRpdHkoJycpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnB1dC5zZXRDdXN0b21WYWxpZGl0eShlcnJvck1lc3NhZ2UpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpbnB1dC5zZXRDdXN0b21WYWxpZGl0eSgnJyk7XG4gIH1cblxuICBpZiAoIWlucHV0LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybSwgaW5wdXQsIGlucHV0LnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm0sIGlucHV0LCBjb25maWcpO1xuICB9XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIHNob3dJbnB1dEVycm9yKGZvcm0sIGlucHV0LCBlcnJvck1lc3NhZ2UsIGNvbmZpZykge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0LmlkfS1lcnJvcmApO1xuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5lcnJvckNsYXNzKTtcbiAgaW5wdXQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhpZGVJbnB1dEVycm9yKGZvcm0sIGlucHV0LCBjb25maWcpIHtcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybS5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gJyc7XG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5lcnJvckNsYXNzKTtcbiAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlU3VibWl0QnV0dG9uU3RhdGUoaW5wdXRzLCBzdWJtaXRCdXR0b24sIGNvbmZpZykge1xuICBjb25zdCBpc1ZhbGlkID0gaW5wdXRzLmV2ZXJ5KChpbnB1dCkgPT4gaW5wdXQudmFsaWRpdHkudmFsaWQpO1xuXG4gIGlmIChpc1ZhbGlkKSB7XG4gICAgc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIHN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICB9IGVsc2Uge1xuICAgIGRpc2FibGVTdWJtaXRCdXR0b24oc3VibWl0QnV0dG9uLCBjb25maWcpXG4gIH1cbn1cblxuXG5mdW5jdGlvbiBkaXNhYmxlU3VibWl0QnV0dG9uKHN1Ym1pdEJ1dHRvbiwgY29uZmlnKSB7XG4gIHN1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbn0iLCJpbXBvcnQgJy4vcGFnZXMvaW5kZXguY3NzJztcbi8vaW1wb3J0IHsgaW5pdGlhbENhcmRzIH0gZnJvbSAnLi9jYXJkcyc7XG5pbXBvcnQgeyBjcmVhdGVDYXJkLCB0b29nbGVIZWFydCwgZGVsZXRlQ2FyZCwgbG9hZExpa2VzU3RhdGUgfSBmcm9tICcuL2NvbXBvbmVudHMvY2FyZCc7XG5pbXBvcnQgeyBvcGVuTW9kYWwsIGNsb3NlTW9kYWwgfSBmcm9tICcuL2NvbXBvbmVudHMvbW9kYWwnO1xuaW1wb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgY2xlYXJWYWxpZGF0aW9uLCBzZXRFdmVudExpc3RlbmVycyB9IGZyb20gJy4vY29tcG9uZW50cy92YWxpZGF0aW9uJztcblxuaW1wb3J0IHsgZ2V0SW5pdGlhbENhcmRzLCB1cGRhdGVVc2VySW5mbywgZ2V0VXNlckluZm8sIHBvc3RDYXJkLCBkZWxldGVDYXJkRnJvbVNlcnZlciwgdXBkYXRlQXZhdGFyIH0gZnJvbSAnLi9jb21wb25lbnRzL2FwaSc7XG5cbi8vQWxsIG1vZGFsIHdpbmRvdy8vXG5jb25zdCBwb3B1cEVkaXRQcm9maWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfZWRpdCcpXG5jb25zdCBwb3B1cEFkZENhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9uZXctY2FyZCcpO1xuZXhwb3J0IGNvbnN0IHBvcHVwSW1nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfaW1hZ2UnKTtcbmNvbnN0IHBvcHVwRWRpdEF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2F2YXRhcicpXG5cbi8vQWxsIGZvcm0vL1xuY29uc3QgZm9ybUVkaXRQcm9maWxlID0gcG9wdXBFZGl0UHJvZmlsZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Zvcm0nKVxuY29uc3QgZm9ybUFkZENhcmQgPSBwb3B1cEFkZENhcmQucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtJylcbmNvbnN0IGZvcm1FZGl0QXZhdGFyID0gcG9wdXBFZGl0QXZhdGFyLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybScpXG5cbi8vQnV0dG9ucyBvcGVuICYgY2xvc2UvL1xuY29uc3Qgb3BlbkVkaXRCdG5Qb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XG5jb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucG9wdXBfX2Nsb3NlJyk7XG5jb25zdCBvcGVuQnRuQWRkQ2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7XG5cbmNvbnN0IHBvcHVwSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2ltYWdlJyk7XG5jb25zdCBwb3B1cENhcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2NhcHRpb24nKTtcblxuY29uc3QgdXNlckF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19pbWFnZScpO1xuXG51c2VyQXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBvcGVuTW9kYWwocG9wdXBFZGl0QXZhdGFyKSB9KTtcblxuXG5cblxuLy8gQHRvZG86IERPTSDRg9C30LvRi1xuY29uc3QgbGlzdENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGFjZXNfX2xpc3QnKTtcblxuLy9nZXRJbml0aWFsQ2FyZHMoKVxuLy8gIC50aGVuKGNhcmRzID0+IHtcbi8vICAgIGxpc3RDb250YWluZXIuaW5uZXJIVE1MID0gJyc7IC8vINCe0YfQuNGJ0LDQtdC8INC60L7QvdGC0LXQudC90LXRgCDQv9C10YDQtdC0INC30LDQs9GA0YPQt9C60L7QuSDQvdC+0LLRi9GFINC60LDRgNGC0L7Rh9C10Lpcbi8vICAgIHJlbmRlckNhcmRzKGNhcmRzLCBkZWxldGVDYXJkLCB0b29nbGVIZWFydCwgb3BlbkJpZ0ltYWdlKTtcbi8vICB9KVxuLy8gIC5jYXRjaChlcnJvciA9PiB7XG4vLyAgICBjb25zb2xlLmVycm9yKCfQntGI0LjQsdC60LAg0LfQsNCz0YDRg9C30LrQuCDQutCw0YDRgtC+0YfQtdC6INGBINGB0LXRgNCy0LXRgNCwJywgZXJyb3IpO1xuLy8gIH0pO1xuXG5jb25zdCB2YWxpZGF0aW9uQ29uZmlnID0ge1xuICBmb3JtU2VsZWN0b3I6ICcucG9wdXBfX2Zvcm0nLFxuICBpbnB1dFNlbGVjdG9yOiAnLnBvcHVwX19pbnB1dCcsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiAnLnBvcHVwX19idXR0b24nLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiAncG9wdXBfX2J1dHRvbl9kaXNhYmxlZCcsXG4gIGlucHV0RXJyb3JDbGFzczogJ3BvcHVwX19pbnB1dF90eXBlX2Vycm9yJyxcbiAgZXJyb3JDbGFzczogJ3BvcHVwX19lcnJvcl92aXNpYmxlJ1xufVxuXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpO1xuXG5jbG9zZUJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBjbG9zZU1vZGFsKGJ1dHRvbi5jbG9zZXN0KCcucG9wdXAnKSk7XG4gIH0pO1xufSk7XG5cbi8vIEB0b2RvOiDQpNGD0L3QutGG0LjRjyDQvtC60YLRgNGL0YLQuNGPINC/0L7Qv9Cw0L/QsCDQutCw0YDRgtC40L3QutC4XG5mdW5jdGlvbiBvcGVuQmlnSW1hZ2UobmV3Q2FyZCwgcGhvdG9DYXJkRWwpIHtcbiAgb3Blbk1vZGFsKHBvcHVwSW1nKTtcbiAgY29uc3QgY2FyZFRpdGxlID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fdGl0bGUnKTtcblxuICBwb3B1cEltYWdlLnNyYyA9IHBob3RvQ2FyZEVsLnNyYztcbiAgcG9wdXBDYXB0aW9uLnRleHRDb250ZW50ID0gY2FyZFRpdGxlLnRleHRDb250ZW50O1xuICBwb3B1cEltZy5zcmMgPSBwaG90b0NhcmRFbC5zcmM7XG4gIHBvcHVwSW1nLmFsdCA9IGNhcmRUaXRsZS50ZXh0Q29udGVudDtcbn1cblxuLy8/IEB0b2RvOiDQktGL0LLQtdGB0YLQuCDQutCw0YDRgtC+0YfQutC4INC90LAg0YHRgtGA0LDQvdC40YbRg1xuXG5mdW5jdGlvbiByZW5kZXJDYXJkcyhjYXJkcywgZGVsZXRlQ2FsbGJhY2ssIHRvb2dsZUhlYXJ0Q2FsbGJhY2ssIG9wZW5CaWdJbWFnZUNhbGxiYWNrLCBvd25lcklkKSB7XG4gIC8vINCh0L7Qt9C00LDRjiDQuCDQtNC+0LHQsNCy0LvRj9GOINC60LDRgNGC0L7Rh9C60Lgg0LIg0LrQvtC90YLQtdC50L3QtdGAXG4gIGNhcmRzLmZvckVhY2goZGF0YSA9PiB7XG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKGRhdGEsIGRlbGV0ZUNhbGxiYWNrLCB0b29nbGVIZWFydENhbGxiYWNrLCBvcGVuQmlnSW1hZ2VDYWxsYmFjaywgb3duZXJJZCk7XG4gICAgLy90b29nbGVIZWFydENhbGxiYWNrKGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWJ1dHRvbicpLCBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpLCBkYXRhLl9pZCwgb3duZXJJZCk7XG4gICAgbGlzdENvbnRhaW5lci5hcHBlbmRDaGlsZChjYXJkRWxlbWVudCk7XG4gIH0pO1xufVxuLy8/INCe0YLQutGA0YvRgtC40LUg0Lgg0LfQsNC60YDRi9GC0LjQtSDQv9C+0L/QsNC/0LAgcG9wdXBFZGl0UHJvZmlsZVxub3BlbkVkaXRCdG5Qb3B1cC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgb3Blbk1vZGFsKHBvcHVwRWRpdFByb2ZpbGUpO1xuICBjbGVhclZhbGlkYXRpb24oZm9ybUVkaXRQcm9maWxlLCB2YWxpZGF0aW9uQ29uZmlnKVxuICBuYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbiAgam9iSW5wdXQudmFsdWUgPSBwcm9maWxlSm9iLnRleHRDb250ZW50O1xuXG4gIGNvbnN0IHNhdmVCdXR0b24gPSBmb3JtRWRpdFByb2ZpbGUucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcbiAgc2F2ZUJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIHNhdmVCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfX2J1dHRvbl9kaXNhYmxlZCcpXG59KTtcblxuLy8/INCd0LDRhdC+0LTQuNC8INC/0L7Qu9GPINGE0L7RgNC80Ysg0LIgRE9NXG5jb25zdCBuYW1lSW5wdXQgPSBmb3JtRWRpdFByb2ZpbGUucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbnB1dF90eXBlX25hbWUnKTtcbmNvbnN0IGpvYklucHV0ID0gZm9ybUVkaXRQcm9maWxlLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9faW5wdXRfdHlwZV9kZXNjcmlwdGlvbicpO1xuXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIik7XG5jb25zdCBwcm9maWxlSm9iID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKVxuXG5uYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbmpvYklucHV0LnZhbHVlID0gcHJvZmlsZUpvYi50ZXh0Q29udGVudDtcblxuXG5cblByb21pc2UuYWxsKFtnZXRVc2VySW5mbygpLCBnZXRJbml0aWFsQ2FyZHMoKV0pXG4gIC50aGVuKChbdXNlckluZm8sIGluaXRpYWxDYXJkc10pID0+IHtcbiAgICB3aW5kb3cudXNlckluZm8gPSB1c2VySW5mbztcbiAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJJbmZvLm5hbWU7XG4gICAgcHJvZmlsZUpvYi50ZXh0Q29udGVudCA9IHVzZXJJbmZvLmFib3V0O1xuXG4gICAgdXNlckF2YXRhci5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCR7dXNlckluZm8uYXZhdGFyfSlgO1xuXG4gICAgbGlzdENvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcblxuICAgIC8vINCg0LXQvdC00LXRgNC40Lwg0LrQsNGA0YLQvtGH0LrQuFxuICAgIHJlbmRlckNhcmRzKGluaXRpYWxDYXJkcywgZGVsZXRlQ2FyZCwgdG9vZ2xlSGVhcnQsIG9wZW5CaWdJbWFnZSwgd2luZG93LnVzZXJJbmZvLl9pZCk7XG4gICAgcmV0dXJuIGdldEluaXRpYWxDYXJkcygpXG4gIH0pXG4gIC5jYXRjaChlcnJvcnMgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoJ9Cf0YDQvtC40LfQvtGI0LvQsCDQvtGI0LjQsdC60LA6JywgZXJyb3JzKTtcbiAgfSk7XG5cbi8vZ2V0VXNlckluZm8oKVxuLy8gIC50aGVuKCh1c2VySW5mbykgPT4ge1xuLy8gICAgd2luZG93LnVzZXJJbmZvID0gdXNlckluZm87XG4vLyAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJJbmZvLm5hbWU7XG4vLyAgICBwcm9maWxlSm9iLnRleHRDb250ZW50ID0gdXNlckluZm8uYWJvdXQ7XG4vLyAgICB1c2VyQXZhdGFyLnVybCA9IHVzZXJJbmZvLmF2YXRhcjtcbi8vICAgIHJldHVybiBnZXRJbml0aWFsQ2FyZHMoKVxuLy8gIH0pXG5cbmZvcm1FZGl0UHJvZmlsZS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzYXZlQnV0dG9uID0gZm9ybUVkaXRQcm9maWxlLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fYnV0dG9uJyk7XG4gIHNhdmVCdXR0b24udGV4dENvbnRlbnQgPSAn0KHQvtGF0YDQsNC90LXQvdC40LUuLi4nO1xuXG5cbiAgdXBkYXRlVXNlckluZm8obmFtZUlucHV0LnZhbHVlLCBqb2JJbnB1dC52YWx1ZSlcbiAgICAudGhlbigodXNlckluZm8pID0+IHtcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlckluZm8ubmFtZTtcbiAgICAgIHByb2ZpbGVKb2IudGV4dENvbnRlbnQgPSB1c2VySW5mby5hYm91dDtcblxuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuXG4gICAgICBzYXZlQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC40YLRjCc7XG4gICAgfSk7XG5cbiAgY2xvc2VNb2RhbChwb3B1cEVkaXRQcm9maWxlKTtcblxuICBjbGVhclZhbGlkYXRpb24oZm9ybUVkaXRQcm9maWxlLCB2YWxpZGF0aW9uQ29uZmlnKTtcblxufSk7XG5cblxub3BlbkJ0bkFkZENhcmQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChwb3B1cEFkZENhcmQpO1xuICBmb3JtQWRkQ2FyZC5yZXNldCgpO1xuXG4gIGNsZWFyVmFsaWRhdGlvbihmb3JtQWRkQ2FyZCwgdmFsaWRhdGlvbkNvbmZpZyk7XG59KVxuXG5mb3JtQWRkQ2FyZC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3QgZm9ybSA9IGV2ZW50LnRhcmdldDtcbiAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSk7XG4gIGNvbnN0IHZhbHVlcyA9IE9iamVjdC5mcm9tRW50cmllcyhmb3JtRGF0YSk7XG4gIGNvbnN0IHZhbHVlTmFtZSA9IHZhbHVlc1sncGxhY2UtbmFtZSddO1xuICBjb25zdCB2YWx1ZVVybCA9IHZhbHVlc1snbGluayddO1xuXG4gIGNvbnN0IHNhdmVCdXR0b24gPSBmb3JtQWRkQ2FyZC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xuICBzYXZlQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC10L3QuNC1Li4uJztcblxuICBwb3N0Q2FyZCh2YWx1ZU5hbWUsIHZhbHVlVXJsKVxuICAgIC50aGVuKG5ld0NhcmQgPT4ge1xuXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQobmV3Q2FyZCwgZGVsZXRlQ2FyZCwgdG9vZ2xlSGVhcnQsIG9wZW5CaWdJbWFnZSwgdXNlckluZm8uX2lkKTtcbiAgICAgIGxpc3RDb250YWluZXIucHJlcGVuZChjYXJkRWxlbWVudCk7XG4gICAgICBmb3JtLnJlc2V0KCk7XG4gICAgICBjbG9zZU1vZGFsKHBvcHVwQWRkQ2FyZCk7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcign0J7RiNC40LHQutCwINC00L7QsdCw0LLQu9C10L3QuNGPINC60LDRgNGC0L7Rh9C60Lg6JywgZXJyb3IpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuXG4gICAgICBzYXZlQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC40YLRjCc7XG4gICAgfSk7XG5cbiAgY2xvc2VNb2RhbChwb3B1cEFkZENhcmQpO1xuXG59KTtcblxuXG4vL9CU0L7QsdCw0LLQu9C10L3QuNC1INCy0YHQtdC8INC/0L7Qv9Cw0L/QsNC8INC60LvQsNGB0YHQsCBwb3B1cF9pcy1hbmltYXRlZFxuY29uc3QgYWxsUG9wcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cCcpO1xuYWxsUG9wcy5mb3JFYWNoKChwb3ApID0+IHBvcC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9pcy1hbmltYXRlZCcpKVxuXG5cbmZvcm1FZGl0QXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGZ1bmN0aW9uIChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IGF2YXRhckxpbmtJbnB1dCA9IGV2ZW50LnRhcmdldC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2lucHV0X3R5cGVfYXZhdGFyLXVybCcpO1xuICBjb25zdCBhdmF0YXJMaW5rID0gYXZhdGFyTGlua0lucHV0LnZhbHVlO1xuICBjb25zdCBzYXZlQnV0dG9uID0gZm9ybUVkaXRBdmF0YXIucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcbiAgc2F2ZUJ1dHRvbi50ZXh0Q29udGVudCA9ICfQodC+0YXRgNCw0L3QtdC90LjQtS4uLic7XG5cbiAgdXBkYXRlQXZhdGFyKGF2YXRhckxpbmspXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgdXNlckF2YXRhci5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCR7YXZhdGFyTGlua30pYDtcbiAgICAgIGNsb3NlTW9kYWwocG9wdXBFZGl0QXZhdGFyKTtcbiAgICAgIGZvcm1FZGl0QXZhdGFyLnJlc2V0KClcbiAgICB9KVxuICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKCfQntGI0LjQsdC60LAg0L7QsdC90L7QstC70LXQvdC40Y8g0LDQstCw0YLQsNGA0LA6JywgZXJyb3IpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2F2ZUJ1dHRvbi50ZXh0Q29udGVudCA9ICfQodC+0YXRgNCw0L3QuNGC0YwnO1xuICAgIH0pO1xufSk7XG5cbiJdLCJuYW1lcyI6WyJjb25maWciLCJiYXNlVXJsIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJoYW5kbGVSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJjb25jYXQiLCJzdGF0dXMiLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsInRoZW4iLCJwb3N0TGlrZSIsImNhcmRJZCIsImFwaVVybCIsIm1ldGhvZCIsImRlbGV0ZUxpa2UiLCJjcmVhdGVDYXJkIiwiZGF0YSIsImRlbGV0ZUNhbGxiYWNrIiwidG9vZ2xlSGVhcnRDYWxsYmFjayIsIm9wZW5CaWdJbWFnZUNhbGxiYWNrIiwib3duZXJJZCIsIm5ld0NhcmQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY29udGVudCIsImZpcnN0RWxlbWVudENoaWxkIiwiY2xvbmVOb2RlIiwidGl0bGVDYXJkZWwiLCJxdWVyeVNlbGVjdG9yIiwicGhvdG9DYXJkRWwiLCJsaWtlQ291bnRFbGVtZW50IiwibGlrZUhlYXJ0IiwiZGVsZXRlSWNvbiIsInRleHRDb250ZW50IiwibmFtZSIsInNyYyIsImxpbmsiLCJhbHQiLCJsaWtlcyIsImxlbmd0aCIsImFkZEV2ZW50TGlzdGVuZXIiLCJfaWQiLCJfbG9hZExpa2VzU3RhdGUiLCJzdG9yZWRMaWtlcyIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJpc0xpa2VkQnlPd25lciIsInNvbWUiLCJsaWtlIiwibG9hZExpa2VzU3RhdGUiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJvd25lciIsInN0eWxlIiwiZGlzcGxheSIsInRvb2dsZUhlYXJ0IiwiaGVhcnQiLCJjb250YWlucyIsInVwZGF0ZWRDYXJkIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwiZGVsZXRlQ2FyZCIsImNhcmRFbGVtZW50IiwiZGVsZXRlQ2FyZEZyb21TZXJ2ZXIiLCJyZW1vdmUiLCJvcGVuTW9kYWwiLCJtb2RhbCIsImFkZCIsImtleURvd25IYW5kbGVyIiwiZG9jdW1lbnRDbGlja0hhbmRsZXIiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiY29kZSIsIl9yZWYiLCJ0YXJnZXQiLCJjbGVhclZhbGlkYXRpb24iLCJmb3JtIiwiaW5wdXRzIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b24iLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImZvckVhY2giLCJpbnB1dCIsImhpZGVJbnB1dEVycm9yIiwiZGlzYWJsZVN1Ym1pdEJ1dHRvbiIsImVycm9yRWxlbWVudCIsImlkIiwiZXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsInRvZ2dsZVN1Ym1pdEJ1dHRvblN0YXRlIiwiZXZlcnkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImRpc2FibGVkIiwicG9wdXBFZGl0UHJvZmlsZSIsInBvcHVwQWRkQ2FyZCIsInBvcHVwSW1nIiwicG9wdXBFZGl0QXZhdGFyIiwiZm9ybUVkaXRQcm9maWxlIiwiZm9ybUFkZENhcmQiLCJmb3JtRWRpdEF2YXRhciIsIm9wZW5FZGl0QnRuUG9wdXAiLCJjbG9zZUJ1dHRvbnMiLCJvcGVuQnRuQWRkQ2FyZCIsInBvcHVwSW1hZ2UiLCJwb3B1cENhcHRpb24iLCJ1c2VyQXZhdGFyIiwibGlzdENvbnRhaW5lciIsInZhbGlkYXRpb25Db25maWciLCJmb3JtU2VsZWN0b3IiLCJvcGVuQmlnSW1hZ2UiLCJjYXJkVGl0bGUiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInBhdHRlcm5NaXNtYXRjaCIsImVycm9yTWVzc2FnZSIsImRhdGFzZXQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInZhbHVlIiwidHJpbSIsInNldEN1c3RvbVZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzZXRFdmVudExpc3RlbmVycyIsImVuYWJsZVZhbGlkYXRpb24iLCJidXR0b24iLCJjbG9zZXN0IiwibmFtZUlucHV0IiwicHJvZmlsZU5hbWUiLCJqb2JJbnB1dCIsInByb2ZpbGVKb2IiLCJzYXZlQnV0dG9uIiwicmVtb3ZlQXR0cmlidXRlIiwiYWxsIiwiY2FyZHMiLCJfcmVmMiIsInVzZXJJbmZvIiwiaW5pdGlhbENhcmRzIiwid2luZG93IiwiYWJvdXQiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJhdmF0YXIiLCJpbm5lckhUTUwiLCJhcHBlbmRDaGlsZCIsImVycm9ycyIsImJvZHkiLCJmaW5hbGx5IiwicmVzZXQiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwidmFsdWVzIiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJ2YWx1ZU5hbWUiLCJ2YWx1ZVVybCIsInByZXBlbmQiLCJwb3AiLCJhdmF0YXJMaW5rIiwidXBkYXRlQXZhdGFyIl0sInNvdXJjZVJvb3QiOiIifQ==